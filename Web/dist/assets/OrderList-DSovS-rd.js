import{a as k,q as w,B as se,I as oe,_ as ue,F as pe,L as ce}from"./index-BPTSMDv6.js";import{d as e,S as _e,_ as fe,a as S,r as I,A as me,c as V,w as t,h as u,o as B,u as _,f as d,a7 as ge,ai as H,a5 as q}from"./index-B3UucCy0.js";import{d as N}from"./index-B6oHoHR2.js";import{S as ve,a as be,b as ye,_ as Oe,E as xe,D as he,c as A}from"./DollarCircleOutlined-BPWsR8zO.js";import{_ as Ce}from"./index-CrBoXpJt.js";import{F as ke}from"./FileAddOutlined-DBB4iiLk.js";import{a as we,_ as Se}from"./index-D2YV9FWX.js";import"./Col-v87KSPMz.js";var ze={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M380 704h264c4.4 0 8-3.6 8-8v-84c0-4.4-3.6-8-8-8h-40c-4.4 0-8 3.6-8 8v36H428v-36c0-4.4-3.6-8-8-8h-40c-4.4 0-8 3.6-8 8v84c0 4.4 3.6 8 8 8zm340-123a40 40 0 1080 0 40 40 0 10-80 0zm239-167.6L935.3 372a8 8 0 00-10.9-2.9l-50.7 29.6-78.3-216.2a63.9 63.9 0 00-60.9-44.4H301.2c-34.7 0-65.5 22.4-76.2 55.5l-74.6 205.2-50.8-29.6a8 8 0 00-10.9 2.9L65 413.4c-2.2 3.8-.9 8.6 2.9 10.8l60.4 35.2-14.5 40c-1.2 3.2-1.8 6.6-1.8 10v348.2c0 15.7 11.8 28.4 26.3 28.4h67.6c12.3 0 23-9.3 25.6-22.3l7.7-37.7h545.6l7.7 37.7c2.7 13 13.3 22.3 25.6 22.3h67.6c14.5 0 26.3-12.7 26.3-28.4V509.4c0-3.4-.6-6.8-1.8-10l-14.5-40 60.3-35.2a8 8 0 003-10.8zM840 517v237H184V517l15.6-43h624.8l15.6 43zM292.7 218.1l.5-1.3.4-1.3c1.1-3.3 4.1-5.5 7.6-5.5h427.6l75.4 208H220l72.7-199.9zM224 581a40 40 0 1080 0 40 40 0 10-80 0z"}}]},name:"car",theme:"outlined"};function P(g){for(var s=1;s<arguments.length;s++){var o=arguments[s]!=null?Object(arguments[s]):{},v=Object.keys(o);typeof Object.getOwnPropertySymbols=="function"&&(v=v.concat(Object.getOwnPropertySymbols(o).filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable}))),v.forEach(function(b){Ie(g,b,o[b])})}return g}function Ie(g,s,o){return s in g?Object.defineProperty(g,s,{value:o,enumerable:!0,configurable:!0,writable:!0}):g[s]=o,g}var U=function(s,o){var v=P({},s,o.attrs);return e(_e,P({},v,{icon:ze}),null)};U.displayName="CarOutlined";U.inheritAttrs=!1;const qe={class:"cardStyle"},Ue={key:0,style:{"font-weight":"bold","font-size":"large"}},Fe={key:1,class:"actionSlot"},$e={__name:"OrderList",setup(g){const s=S(!1),o=S(!1),v=S(null),b=S(null),i=I({plate:"",price:"",begin_time:"",end_time:""}),r=I({id:"",user:"",plate:"",price:"",begin_time:"",end_time:""}),T={plate:[{required:!0,message:"请输入车牌号",trigger:"blur"},{min:4,message:"车牌号长度不能小于4位",trigger:"blur"}],price:[{required:!0,message:"请输入单价",trigger:"blur"}],begin_time:[{required:!0,message:"请输入开始时间",trigger:"blur"},{pattern:/^(\d{4})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})$/,message:"请输入正确的时间格式",trigger:"blur"}],end_time:[{pattern:/^(\d{4})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})$/,message:"请输入正确的时间格式",trigger:"blur"}]},G={plate:[{required:!0,message:"请输入车牌号",trigger:"blur"},{min:4,message:"车牌号长度不能小于4位",trigger:"blur"}],price:[{required:!0,message:"请输入单价",trigger:"blur"}],begin_time:[{required:!0,message:"请输入开始时间",trigger:"blur"},{pattern:/^(\d{4})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})$/,message:"请输入正确的时间格式",trigger:"blur"}],end_time:[{pattern:/^(\d{4})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})$/,message:"请输入正确的时间格式",trigger:"blur"}]},J=[{title:"ID",dataIndex:"id",key:"id",width:100,align:"center"},{title:"用户名",dataIndex:"user",key:"user",width:200,align:"center"},{title:"车牌号",dataIndex:"plate",key:"plate",width:200,align:"center"},{title:"总额",dataIndex:"amount",key:"amount",width:200,align:"center"},{title:"停车时长",dataIndex:"duration",key:"duration",width:200,align:"center"},{title:"开始时间",dataIndex:"begin_time",key:"begin_time",width:200,align:"center"},{title:"结束时间",dataIndex:"end_time",key:"end_time",width:200,align:"center"},{title:"操作",key:"action",width:400,align:"center"}],f=I({pageSizeOptions:["2","5","10","20"],pageSize:5,total:0,showSizeChanger:!0,showTotal:n=>`共${n}条`}),F=S("id"),M=S("sesc"),$=S([]),h=I({pagenum:1,pagesize:5}),z=I({key:"",content:""});async function x(){const{data:n}=await k.get("api/manage/order.query",{params:{sort_column:F.value,sort:M.value,off:h.pagenum*h.pagesize-h.pagesize,limit:h.pagesize}});if(n.status!==0){u.error(n.msg);return}$.value=n.data.query;const{data:a}=await k.get("api/manage/order.query",{params:{no_data:1}});if(a.status!==0){u.error(a.msg);return}f.total=a.data.count}function K(n,a,m){f.current=n.current,f.pageSize=n.pageSize,h.pagesize=n.pageSize,h.pagenum=n.current,f.pageSize!==n.pageSize&&(h.pagenum=1,f.current=1),x()}function Q(n){F.value=n,x()}function W(n){M.value=n,x()}async function X(){if(z.content===""){x();return}let n=w.stringify({[z.key]:z.content});const{data:a}=await k.post("api/manage/order.info",n);if(a.status!==0){u.error(a.msg);return}$.value=a.data.info,f.total=a.data.count,f.current=1,f.pageSize=f.total}function Y(n){z.key=n}const Z=()=>{let n="";i.end_time?n=w.stringify({plate:i.plate,price:i.price,begin_time:i.begin_time,end_time:i.end_time}):n=w.stringify({plate:i.plate,price:i.price,begin_time:i.begin_time}),b.value.validateFields().then(()=>k.post("api/manage/order.add",n)).then(a=>{const m=a.data;if(m.status!==0)throw new Error(m.msg);b.value.resetFields(),s.value=!1,u.success("添加订单成功"),x()}).catch(a=>{u.error(a.message||"发生错误，请重试")})},ee=()=>{b.value.resetFields(),s.value=!1,u.info("新增订单已取消")};async function te(n){o.value=!0;const{data:a}=await k.post("api/manage/order.info",w.stringify({id:n}));r.id=n,r.user=a.data.info[0].user,r.plate=a.data.info[0].plate,r.price=a.data.info[0].price,r.begin_time=a.data.info[0].begin_time,r.end_time=a.data.info[0].end_time}function ae(){let n="";r.end_time?n=w.stringify({id:r.id,plate:r.plate,price:r.price,begin_time:r.begin_time,end_time:r.end_time}):n=w.stringify({id:r.id,plate:r.plate,price:r.price,begin_time:r.begin_time}),v.value.validateFields().then(()=>k.post("api/manage/order.modify",n)).then(a=>{const m=a.data;if(m.status!=0){u.error(m.msg);return}o.value=!1,u.success("更新订单信息成功"),x()}).catch(a=>{a&&a.message?u.error(a.message):u.error("发生错误，请重试")})}function ne(){v.value.resetFields(),o.value=!1,u.info("编辑已取消")}function re(n){N.confirm({title:"提示：请再次确认",content:"确定要删除该订单吗？一旦删除，无法恢复",onOk:async()=>{const{data:a}=await k.post("api/manage/order.del",w.stringify({id:n}));if(a.status!=0)return u.error(a.msg);u.success("删除成功"),x()},onCancel:()=>{u.info("已取消删除")}})}return me(()=>{x()}),(n,a)=>{const m=se,c=Se,p=ve,D=be,le=Ce,R=ye,C=we,ie=Oe,y=oe,O=ue,j=pe,E=N;return B(),V("div",qe,[e(C,{justify:"space-between"},{default:t(()=>[e(c,{span:4},{default:t(()=>[e(m,{onClick:a[0]||(a[0]=l=>s.value=!0)},{default:t(()=>[e(_(ke)),d("新增订单 ")]),_:1})]),_:1}),e(c,{span:8},{default:t(()=>[e(R,null,{default:t(()=>[e(le,{value:z.content,"onUpdate:value":a[1]||(a[1]=l=>z.content=l),placeholder:"请输入用户名/车牌号/起止时间","enter-button":"",allowClear:"",bordered:"",onSearch:X},{addonBefore:t(()=>[e(D,{placeholder:"搜索关键字",onChange:Y,style:{"background-color":"rgba(255,255,255,0.3)","border-radius":"5px","min-width":"100px"}},{default:t(()=>[e(p,{value:"user_name",style:{"text-align":"center"}},{default:t(()=>[d("用户名")]),_:1}),e(p,{value:"plate",style:{"text-align":"center"}},{default:t(()=>[d("车牌号")]),_:1}),e(p,{value:"begin_time",style:{"text-align":"center"}},{default:t(()=>[d("开始时间")]),_:1}),e(p,{value:"end_time",style:{"text-align":"center"}},{default:t(()=>[d("结束时间")]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),e(c,{span:6,style:{"text-align":"end"}},{default:t(()=>[e(R,null,{default:t(()=>[e(D,{placeholder:"排序顺序",onChange:W},{default:t(()=>[e(p,{value:"asc"},{default:t(()=>[d("升序")]),_:1}),e(p,{value:"desc"},{default:t(()=>[d("降序")]),_:1})]),_:1}),e(D,{placeholder:"请选择排序关键字",style:{width:"160px","text-align":"center"},onChange:Q},{default:t(()=>[e(p,{value:"id",style:{"text-align":"center"}},{default:t(()=>[d("ID")]),_:1}),e(p,{value:"user",style:{"text-align":"center"}},{default:t(()=>[d("用户名")]),_:1}),e(p,{value:"plate",style:{"text-align":"center"}},{default:t(()=>[d("车牌号")]),_:1}),e(p,{value:"amount",style:{"text-align":"center"}},{default:t(()=>[d("总额")]),_:1}),e(p,{value:"duration",style:{"text-align":"center"}},{default:t(()=>[d("停车时长")]),_:1}),e(p,{value:"begin_time",style:{"text-align":"center"}},{default:t(()=>[d("开始时间")]),_:1}),e(p,{value:"end_time",style:{"text-align":"center"}},{default:t(()=>[d("结束时间")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(C,{style:{margin:"10px 0"}},{default:t(()=>[e(ie,{rowKey:"id",columns:J,pagination:f,dataSource:$.value,bordered:"",onChange:K,style:{"overflow-x":"auto"}},{bodyCell:t(({column:l,record:L})=>[l.key===F.value?(B(),V("span",Ue,ge(L[l.key]),1)):H("",!0),l.key==="action"?(B(),V("div",Fe,[e(m,{type:"primary",style:{"margin-right":"15px"},onClick:de=>te(L.id)},{default:t(()=>[e(_(xe)),d("编辑 ")]),_:2},1032,["onClick"]),e(m,{type:"primary",danger:"",style:{"margin-right":"15px"},onClick:de=>re(L.id)},{default:t(()=>[e(_(he)),d("删除 ")]),_:2},1032,["onClick"])])):H("",!0)]),_:1},8,["pagination","dataSource"])]),_:1}),e(E,{closable:"",title:"新增订单",open:s.value,width:"60%",onOk:Z,onCancel:ee,destroyOnClose:""},{default:t(()=>[e(j,{model:i,rules:G,ref_key:"addOrderRef",ref:b},{default:t(()=>[e(C,null,{default:t(()=>[e(c,{span:10},{default:t(()=>[e(O,{label:"车牌号",name:"plate"},{default:t(()=>[e(y,{value:i.plate,"onUpdate:value":a[2]||(a[2]=l=>i.plate=l)},{prefix:t(()=>[e(_(U))]),_:1},8,["value"])]),_:1})]),_:1}),e(c,{offset:2,span:10},{default:t(()=>[e(O,{label:"单价",name:"price"},{default:t(()=>[e(y,{value:i.price,"onUpdate:value":a[3]||(a[3]=l=>i.price=l)},{prefix:t(()=>[e(_(A))]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),e(C,null,{default:t(()=>[e(c,{span:10},{default:t(()=>[e(O,{label:"开始时间",name:"begin_time"},{default:t(()=>[e(y,{value:i.begin_time,"onUpdate:value":a[4]||(a[4]=l=>i.begin_time=l)},{prefix:t(()=>[e(_(q))]),_:1},8,["value"])]),_:1})]),_:1}),e(c,{offset:2,span:10},{default:t(()=>[e(O,{label:"结束时间",name:"end_time"},{default:t(()=>[e(y,{value:i.end_time,"onUpdate:value":a[5]||(a[5]=l=>i.end_time=l)},{prefix:t(()=>[e(_(q))]),_:1},8,["value"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["open"]),e(E,{closable:"",destroyOnClose:"",title:"编辑订单",open:o.value,width:"60%",onOk:ae,onCancel:ne},{default:t(()=>[e(j,{model:r,rules:T,ref_key:"editOrderRef",ref:v},{default:t(()=>[e(C,null,{default:t(()=>[e(c,{span:10},{default:t(()=>[e(O,{label:"用户名",name:"user"},{default:t(()=>[e(y,{value:r.user,"onUpdate:value":a[6]||(a[6]=l=>r.user=l),disabled:""},{prefix:t(()=>[e(_(ce))]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),e(C,null,{default:t(()=>[e(c,{span:10},{default:t(()=>[e(O,{label:"车牌号",name:"plate"},{default:t(()=>[e(y,{value:r.plate,"onUpdate:value":a[7]||(a[7]=l=>r.plate=l)},{prefix:t(()=>[e(_(U))]),_:1},8,["value"])]),_:1})]),_:1}),e(c,{offset:2,span:10},{default:t(()=>[e(O,{label:"单价",name:"price"},{default:t(()=>[e(y,{value:r.price,"onUpdate:value":a[8]||(a[8]=l=>r.price=l)},{prefix:t(()=>[e(_(A))]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),e(C,null,{default:t(()=>[e(c,{span:10},{default:t(()=>[e(O,{label:"开始时间",name:"begin_time"},{default:t(()=>[e(y,{value:r.begin_time,"onUpdate:value":a[9]||(a[9]=l=>r.begin_time=l)},{prefix:t(()=>[e(_(q))]),_:1},8,["value"])]),_:1})]),_:1}),e(c,{offset:2,span:10},{default:t(()=>[e(O,{label:"结束时间",name:"end_time"},{default:t(()=>[e(y,{value:r.end_time,"onUpdate:value":a[10]||(a[10]=l=>r.end_time=l)},{prefix:t(()=>[e(_(q))]),_:1},8,["value"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])])}}},He=fe($e,[["__scopeId","data-v-86d8b8ca"]]);export{He as default};
